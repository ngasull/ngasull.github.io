<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width"/><title>Articles | Nico&#x27;s Lab</title><meta name="next-head-count" content="3"/><link rel="preload" href="/_next/static/css/67269c7d1e9da300.css" as="style"/><link rel="stylesheet" href="/_next/static/css/67269c7d1e9da300.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-c67a75d1b6f99dc8.js"></script><script src="/_next/static/chunks/webpack-8fa1640cc84ba8fe.js" defer=""></script><script src="/_next/static/chunks/framework-3b5a00d5d7e8d93b.js" defer=""></script><script src="/_next/static/chunks/main-11be7a5831576890.js" defer=""></script><script src="/_next/static/chunks/pages/_app-3b641619ed056464.js" defer=""></script><script src="/_next/static/chunks/814-f83b2571d190bfbd.js" defer=""></script><script src="/_next/static/chunks/pages/fr-84b805e15e422270.js" defer=""></script><script src="/_next/static/XfiD0591POrqhAMreRIZE/_buildManifest.js" defer=""></script><script src="/_next/static/XfiD0591POrqhAMreRIZE/_ssgManifest.js" defer=""></script></head><body><div id="__next"><header class="ng-header"><h1>Le labo de Nico</h1><h3 class="py-2 md:p-0">ğŸ”­ ğŸ¶ ğŸ•º</h3><nav><a href="/fr">Blog</a> / <a href="/fr/about">Ã€ propos</a> / <a href="/fr/rss.xml">RSS</a> / <a href="/">ğŸ‡¬ğŸ‡§</a></nav></header><main aria-label="Content"><h1>Articles</h1><article><h3><a href="/fr/blog/pourquoi-docker">ğŸ“– Pourquoi Docker ?</a></h3>Blog Â» 6 aoÃ»t 2020 Â» devops</article><article><h3><a href="/fr/blog/gerer-ses-permissions-avec-docker">ğŸ“– GÃ©rer ses permissions avec Docker</a></h3>Blog Â» 1 sept. 2020 Â» devops</article></main><footer class="mt-8 text-center"><p>Copyright Â© 2019<!-- -->-2022<!-- --> <a href="/fr/about">NicolasÂ Gasull</a></p><address class="space-x-5"><a href="https://www.twitter.com/ngasull"><svg class="w-4 h-4 p-2 -m-2 align-text-top fill-current"><use xlink:href="/svg/icons.svg#twitter"></use></svg></a><a href="https://www.github.com/ngasull"><svg class="w-4 h-4 p-2 -m-2 align-text-top fill-current"><use xlink:href="/svg/icons.svg#github"></use></svg></a><a href="https://stackoverflow.com/users/2219133/ngasull"><svg class="w-4 h-4 p-2 -m-2 align-text-top fill-current"><use xlink:href="/svg/icons.svg#stackoverflow"></use></svg></a><a href="https://www.linkedin.com/in/nicolasgasull"><svg class="w-4 h-4 p-2 -m-2 align-text-top fill-current"><use xlink:href="/svg/icons.svg#linkedin"></use></svg></a><a href="/fr/about"><svg class="w-4 h-4 p-2 -m-2 align-text-top fill-current"><use xlink:href="/svg/icons.svg#at"></use></svg></a><a href="/fr/rss.xml"><svg class="w-4 h-4 p-2 -m-2 align-text-top fill-current"><use xlink:href="/svg/icons.svg#rss"></use></svg></a></address></footer></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"locale":"fr","articles":[{"date":"2020-08-06","slug":"pourquoi-docker","lang":"fr","title":"Pourquoi Docker ?","html":"\u003csection class=\"doc-section level-1\"\u003e\u003ch2 id=\"_pour_travailler_ensemble\"\u003ePour travailler ensemble\u003c/h2\u003e\u003cp\u003eTout le monde dÃ©veloppe sur diffÃ©rentes machines. Il nâ€™est pas rare que plusieurs collÃ¨gues aient installÃ© diffÃ©rentes version dâ€™une mÃªme library, dâ€™un package manager, du runtime de leur applicationâ€¦â€‹ (cc node/npm ğŸ‘‹)\u003c/p\u003e\n\u003cp\u003eLorsque lâ€™application de dÃ©veloppement est dockerisÃ©e, tous les devs (et la prod !) sont soumis aux mÃªmes rÃ¨gles, ce qui Ã©vite le syndrÃ´me de \u003cem\u003e\"mais Ã§a marche sur mon PC\"\u003c/em\u003e tout en rÃ©duisant la configuration nÃ©cessaire Ã  installer lâ€™environnement de dev. Voir juste aprÃ¨s !\u003c/p\u003e\u003c/section\u003e\n\u003csection class=\"doc-section level-1\"\u003e\u003ch2 id=\"_pour_moins_perdre_de_temps_Ã _configurer\"\u003ePour moins perdre de temps Ã  configurer\u003c/h2\u003e\u003cp\u003eLa configuration, câ€™est du temps passÃ© Ã  ne pas Ãªtre productif. Plus il y a dâ€™environnements dans lesquels une application doit tourner, plus il y a de configuration Ã  faire. Docker permet dâ€™abstraire lâ€™environnement dans lequel tourne lâ€™application et donc de ne faire que le minimum nÃ©cessaire.\u003c/p\u003e\n\u003cp\u003eUne consÃ©quence notable : pour ajouter un service Ã  la stack, plus forcÃ©ment besoin dâ€™apprendre en dÃ©tails une technologie. Il suffit dâ€™ajouter une image existante de celle-ci, et de simplement spÃ©cifier les variables dâ€™environnement nÃ©cessaires. Par exemple, pour \u003ca href=\"https://hub.docker.com/_/postgres/\"\u003eajouter une database PostgreSQL\u003c/a\u003e, il suffit au minimum de renseigner un root password et de monter un volume pour persister les donnÃ©es.\u003c/p\u003e\u003c/section\u003e\n\u003csection class=\"doc-section level-1\"\u003e\u003ch2 id=\"_pour_sÃ©parer_les_problÃ¨mes\"\u003ePour sÃ©parer les problÃ¨mes\u003c/h2\u003e\u003cp\u003eComme chaque service est aussi simple que possible, chacun nâ€™a que trÃ¨s peu de dÃ©pendances avec le reste du monde. On voit que, par nature, les conteneurs nous poussent Ã  nâ€™avoir que le minimum vital de dÃ©pendances entre services.\u003c/p\u003e\n\u003cp\u003ePar dÃ©pendances, je pense en particulier Ã  :\u003c/p\u003e\n\u003cdiv class=\"ulist\"\u003e\u003cul\u003e\u003cli\u003eSystÃ¨me, programmes, libraries installÃ©es\u003c/li\u003e\u003cli\u003eConfigurations associÃ©es Ã  ce setup\u003c/li\u003e\u003cli\u003eVolumes (fichiers)\u003c/li\u003e\u003cli\u003eAccÃ¨s rÃ©seau\u003c/li\u003e\u003c/ul\u003e\u003c/div\u003e\u003c/section\u003e\n\u003csection class=\"doc-section level-1\"\u003e\u003ch2 id=\"_pour_gÃ©rer_et_sÃ©curiser_les_connexions_rÃ©seau\"\u003ePour gÃ©rer et sÃ©curiser les connexions rÃ©seau\u003c/h2\u003e\u003cp\u003eCar oui : câ€™est vite fait de faire fuiter le port dâ€™une database, et \u003ca href=\"https://www.bleepingcomputer.com/news/security/new-meow-attack-has-deleted-almost-4-000-unsecured-databases/\"\u003equand elle nâ€™est pas sÃ©curisÃ©e câ€™est gÃªnant\u003c/a\u003e ğŸ˜¬\u003c/p\u003e\n\u003cp\u003eLâ€™idÃ©e est de penser un service comme une boÃ®te noire qui expose un ou plusieurs ports. Les services communiquent entre eux grÃ¢ce aux volumes montÃ©s en commun ou Ã  travers des ports internes. En effet, les \u003ca href=\"https://docs.docker.com/compose/networking/\"\u003eservices appartenant Ã  un mÃªme rÃ©seau\u003c/a\u003e peuvent par dÃ©faut sâ€™accÃ©der entre eux.\u003c/p\u003e\u003c/section\u003e\n\u003csection class=\"doc-section level-1\"\u003e\u003ch2 id=\"_piÃ¨ges_et_trucs_Ã _savoir\"\u003ePiÃ¨ges et trucs Ã  savoir\u003c/h2\u003e\u003cp\u003eSous Windows et Mac, les conteneurs tournent sur une VM. Du coup câ€™est lent, pas natif et les lectures/Ã©critures disque peuvent ralentir lâ€™Ã©dition de fichiers. La solution est simple : utilise Linux ğŸ˜ (ou un Windows/Mac puissant)\u003c/p\u003e\n\u003cp\u003eLorsquâ€™un mÃªme volume (dossier) est montÃ© en Ã©criture dans deux conteneurs Ã  la fois, on peut se retrouver avec des comportements inattendus : chez moi, lâ€™intÃ©gralitÃ© du dossier gÃ©nÃ©rÃ© par un run de build disparaissait en mÃªme temps que le conteneur Ã  la fin du run. Je recommande donc vivement de ne monter en Ã©criture quâ€™un seul fichier ou dossier Ã  la fois.\u003c/p\u003e\n\u003cp\u003eCâ€™est possible de ne partager en Ã©criture quâ€™une partie dâ€™une mÃªme arborescence commune. Par exemple, si \u003ccode\u003ebackend\u003c/code\u003e et \u003ccode\u003efrontend\u003c/code\u003e partagent \u003ccode\u003ecode\u003c/code\u003e en lecture mais que \u003ccode\u003ebackend\u003c/code\u003e doit Ã©crire dans \u003ccode\u003ecode/target\u003c/code\u003e et \u003ccode\u003efrontend\u003c/code\u003e doit Ã©crire dans \u003ccode\u003ecode/dist\u003c/code\u003e, alors les volumes peuvent Ãªtre surchargÃ©s comme ceci :\u003c/p\u003e\n\u003cdiv class=\"listing-block\"\u003e\u003cpre class=\"highlightjs highlight\"\u003e\u003ccode class=\"language-yml hljs language-yaml\" data-lang=\"yml\"\u003e\u003cspan class=\"hljs-attr\"\u003ebackend:\u003c/span\u003e\n  \u003cspan class=\"hljs-attr\"\u003evolumes:\u003c/span\u003e\n    \u003cspan class=\"hljs-bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e./code:/code:ro\u003c/span\u003e\n    \u003cspan class=\"hljs-bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e./code/target:/code/target\u003c/span\u003e\n\n\u003cspan class=\"hljs-attr\"\u003ewebapp:\u003c/span\u003e\n  \u003cspan class=\"hljs-attr\"\u003evolumes:\u003c/span\u003e\n    \u003cspan class=\"hljs-bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e./code:/code:ro\u003c/span\u003e\n    \u003cspan class=\"hljs-bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e./code/dist:/code/dist\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eLes images Docker peuvent vite prendre de lâ€™espace disque. Mais avec le temps, la communautÃ© opte de plus en plus pour des versions minimalistes de chaque image. Autrefois avec une version \u003cem\u003eslim\u003c/em\u003e de Debian, et aujourdâ€™hui souvent avec une version \u003ca href=\"https://alpinelinux.org/about/\"\u003eAlpine Linux\u003c/a\u003e qui permet aux images de faire moins de 10Mo de base ! PrÃ©fÃ¨re-donc utiliser les tags \u003ccode\u003e-alpine\u003c/code\u003e de chaque image.\u003c/p\u003e\n\u003cp\u003eEnfin, la gestion des permissions est dÃ©routante au dÃ©but. Docker tourne en root par dÃ©faut et a de bonnes raisons de le faire : autant dire que jâ€™apprÃ©cie de pouvoir ouvrir les ports 80 ou 443 en dev comme en prod ğŸ™‚\u003c/p\u003e\n\u003cp\u003ePour mieux comprendre pourquoi et comment bien gÃ©rer ses permissions : \u003ca href=\"/fr/blog/gerer-ses-permissions-avec-docker\"\u003evoir cet article\u003c/a\u003e.\u003c/p\u003e\u003c/section\u003e\n\u003csection class=\"doc-section level-1\"\u003e\u003ch2 id=\"_par_oÃ¹_commencer\"\u003ePar oÃ¹ commencer?\u003c/h2\u003e\u003cp\u003eEn prenant le temps de lire la doc dans lâ€™ordre, tout ne peut que bien se passer :\u003c/p\u003e\n\u003cdiv class=\"olist arabic\"\u003e\u003col class=\"arabic\"\u003e\u003cli\u003e\u003ca href=\"https://docs.docker.com/get-started/overview/\"\u003eComprends Docker\u003c/a\u003e\u003c/li\u003e\u003cli\u003e\u003ca href=\"https://docs.docker.com/compose/\"\u003eComprends docker compose\u003c/a\u003e pour simplement faire cohabiter les services entre eux\u003c/li\u003e\u003cli\u003eInstalle \u003ca href=\"https://docs.docker.com/engine/install/\"\u003edocker\u003c/a\u003e et \u003ca href=\"https://docs.docker.com/compose/install/\"\u003eson plugin compose\u003c/a\u003e\u003c/li\u003e\u003cli\u003e\u003ca href=\"https://docs.docker.com/engine/install/linux-postinstall/#manage-docker-as-a-non-root-user\"\u003eAjoute ton user au groupe \u003ccode\u003edocker\u003c/code\u003e\u003c/a\u003e pour piloter le daemon sans \u003ccode\u003esudo\u003c/code\u003e\u003c/li\u003e\u003cli\u003eCâ€™est parti ! Nâ€™oublie pas de garder la configuration la plus simple possible.\u003c/li\u003e\u003c/ol\u003e\u003c/div\u003e\n\u003cdetails\u003e\u003csummary\u003eExemple\u003c/summary\u003e\u003cdiv class=\"content\"\u003e\u003cp\u003eUne stack complÃ¨te React/Rust/PostgreSQL pourrait Ãªtre lancÃ©e avec la simple config suivante Ã  la racine dâ€™un projet :\u003c/p\u003e\n\u003cdiv class=\"listing-block\"\u003e\u003cpre class=\"highlightjs highlight\"\u003e\u003ccode class=\"language-yml hljs language-yaml\" data-lang=\"yml\"\u003e\u003cspan class=\"hljs-attr\"\u003eversion:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\"3\"\u003c/span\u003e\n\u003cspan class=\"hljs-attr\"\u003eservices:\u003c/span\u003e\n  \u003cspan class=\"hljs-attr\"\u003edb:\u003c/span\u003e\n    \u003cspan class=\"hljs-attr\"\u003eimage:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003epostgres:alpine\u003c/span\u003e\n    \u003cspan class=\"hljs-attr\"\u003eenvironment:\u003c/span\u003e\n      \u003cspan class=\"hljs-bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003ePOSTGRES_PASSWORD=yolo\u003c/span\u003e\n    \u003cspan class=\"hljs-attr\"\u003evolumes:\u003c/span\u003e\n      \u003cspan class=\"hljs-bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e./db/data:/var/lib/postgresql/data\u003c/span\u003e\n  \u003cspan class=\"hljs-attr\"\u003ebackend:\u003c/span\u003e\n    \u003cspan class=\"hljs-attr\"\u003eimage:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003erust:slim\u003c/span\u003e\n    \u003cspan class=\"hljs-attr\"\u003eenvironment:\u003c/span\u003e\n      \u003cspan class=\"hljs-bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003ePGHOST=db\u003c/span\u003e\n      \u003cspan class=\"hljs-bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003ePGDATABASE=monservice\u003c/span\u003e\n      \u003cspan class=\"hljs-bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003ePGUSER=root\u003c/span\u003e\n      \u003cspan class=\"hljs-bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003ePGPASSWORD=yolo\u003c/span\u003e\n    \u003cspan class=\"hljs-attr\"\u003evolumes:\u003c/span\u003e\n      \u003cspan class=\"hljs-bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e./backend/:/home/backend\u003c/span\u003e\n      \u003cspan class=\"hljs-bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e./webapp/:/home/webapp:ro\u003c/span\u003e\n    \u003cspan class=\"hljs-attr\"\u003ecommand:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003ecargo\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003erun\u003c/span\u003e\n    \u003cspan class=\"hljs-attr\"\u003eports:\u003c/span\u003e\n      \u003cspan class=\"hljs-bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"hljs-number\"\u003e4000\u003c/span\u003e\u003cspan class=\"hljs-string\"\u003e:4000\u003c/span\u003e\n  \u003cspan class=\"hljs-attr\"\u003ewebapp:\u003c/span\u003e\n    \u003cspan class=\"hljs-attr\"\u003eimage:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003enode:alpine\u003c/span\u003e\n    \u003cspan class=\"hljs-attr\"\u003eenvironment:\u003c/span\u003e\n      \u003cspan class=\"hljs-bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003eBACKEND_URL=http://backend:4000/\u003c/span\u003e\n    \u003cspan class=\"hljs-attr\"\u003evolumes:\u003c/span\u003e\n      \u003cspan class=\"hljs-bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e./webapp/:/home/webapp\u003c/span\u003e\n    \u003cspan class=\"hljs-attr\"\u003ecommand:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003esh\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e-c\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\"yarn install \u0026amp;\u0026amp; CI=true yarn start\"\u003c/span\u003e\n    \u003cspan class=\"hljs-attr\"\u003eports:\u003c/span\u003e\n      \u003cspan class=\"hljs-bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"hljs-number\"\u003e80\u003c/span\u003e\u003cspan class=\"hljs-string\"\u003e:8080\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003e\u003ccode\u003edocker compose up -d\u003c/code\u003e et câ€™est parti directement sur \u003ca href=\"http://localhost\"\u003elocalhost\u003c/a\u003e ! ğŸ’»\u003c/p\u003e\u003c/div\u003e\u003c/details\u003e\u003c/section\u003e","categories":["devops"]},{"date":"2020-09-01","slug":"gerer-ses-permissions-avec-docker","lang":"fr","title":"GÃ©rer ses permissions avec Docker","html":"\u003csection id=\"preamble\" aria-label=\"Preamble\"\u003e\u003cp\u003eTout dâ€™abord soyons dâ€™accord sur les mots :\u003c/p\u003e\n\u003cdiv class=\"ulist\"\u003e\u003cul\u003e\u003cli\u003eL'\u003cstrong\u003e\u003cem\u003ehÃ´te\u003c/em\u003e\u003c/strong\u003e est le systÃ¨me dâ€™exploitation de la machine, celui qui fait tourner Docker lui-mÃªme\u003c/li\u003e\u003cli\u003eNous utiliserons \u003cstrong\u003e\u003cem\u003econteneur\u003c/em\u003e\u003c/strong\u003e pour se rÃ©fÃ©rer Ã  ce qui est exÃ©cutÃ© dans lâ€™univers de Docker\u003c/li\u003e\u003cli\u003eLes \u003cstrong\u003e\u003cem\u003euser namespaces\u003c/em\u003e\u003c/strong\u003e, que jâ€™appellerai \u003cstrong\u003e\u003cem\u003esubuids\u003c/em\u003e\u003c/strong\u003e, sont une fonctionnalitÃ© native Unix pour faire correspondre les ids dâ€™utilisateurs systÃ¨me vers une page dâ€™utilisateurs donnÃ©e.\u003c/li\u003e\u003c/ul\u003e\u003c/div\u003e\n\u003cp\u003eLâ€™article dÃ©crit comment utiliser les user namespaces (\u003cem\u003esubuids\u003c/em\u003e) dans un environnement Unix pour rÃ©server une plage dâ€™utilisateurs au daemon Docker. Il est probable que Docker for Mac supporte cette fonctionnalitÃ©.\u003c/p\u003e\u003c/section\u003e\u003cnav id=\"toc\" class=\"toc\" role=\"doc-toc\"\u003e\u003ch2 id=\"toc-title\"\u003eTable des matiÃ¨res\u003c/h2\u003e\u003col class=\"toc-list level-1\"\u003e\u003cli\u003e\u003ca href=\"#_motivation\"\u003eMotivation\u003c/a\u003e\u003c/li\u003e\u003cli\u003e\u003ca href=\"#_mise_en_place\"\u003eMise en place\u003c/a\u003e\u003col class=\"toc-list level-2\"\u003e\u003cli\u003e\u003ca href=\"#_mappings_de_dev\"\u003eMappings de dev\u003c/a\u003e\u003c/li\u003e\u003cli\u003e\u003ca href=\"#_mappings_de_ciproduction\"\u003eMappings de CI/production\u003c/a\u003e\u003c/li\u003e\u003c/ol\u003e\u003c/li\u003e\u003cli\u003e\u003ca href=\"#_problÃ¨mes_et_trucs_Ã _savoir\"\u003eProblÃ¨mes et trucs Ã  savoir\u003c/a\u003e\u003c/li\u003e\u003c/ol\u003e\u003c/nav\u003e\n\u003csection class=\"doc-section level-1\"\u003e\u003ch2 id=\"_motivation\"\u003eMotivation\u003c/h2\u003e\u003cp\u003eSur lâ€™hÃ´te, sans configuration donnÃ©e, les fichiers manipulÃ©s par Docker appartiennent au mÃªme utilisateur que celui du conteneur. Ce nâ€™est pas rassurant dans le sens oÃ¹ le daemon Docker tourne en \u003ccode\u003eroot\u003c/code\u003e par dÃ©faut et que les conteneurs ne sont pas tenus de sâ€™exÃ©cuter en tant que lâ€™utilisateur qui leur a Ã©tÃ© donnÃ© en configuration.\u003c/p\u003e\n\u003cfigure class=\"example-block\"\u003e\u003cfigcaption\u003eExemple :\u003c/figcaption\u003e\n\u003cdiv class=\"example\"\u003eLes images \u003ccode\u003epostgres\u003c/code\u003e et \u003ccode\u003emysql\u003c/code\u003e Ã©crivent dâ€™elles-mÃªmes une partie de leurs fichiers avec les les utilisateurs de PostgreSQL et MySQL.\u003c/div\u003e\u003c/figure\u003e\n\u003cp\u003ePour Ã©viter ce problÃ¨me, nous allons indiquer au daemon Docker Ã  quels utilisateurs hÃ´te correspondent tous les utilisateurs des conteneurs.\u003c/p\u003e\u003c/section\u003e\n\u003csection class=\"doc-section level-1\"\u003e\u003ch2 id=\"_mise_en_place\"\u003eMise en place\u003c/h2\u003e\u003ch5 id=\"_configuration_hÃ´te_impactÃ©e\" class=\"discrete\"\u003eConfiguration hÃ´te impactÃ©e :\u003c/h5\u003e\n\u003cdiv class=\"ulist\"\u003e\u003cul\u003e\u003cli\u003e\u003ccode\u003e/etc/subuid\u003c/code\u003e - configuration des mappings utilisateur hÃ´te â‡â‡’ conteneur\u003c/li\u003e\u003cli\u003e\u003ccode\u003e/etc/subgid\u003c/code\u003e - configuration des mappings groupe hÃ´te â‡â‡’ conteneur\u003c/li\u003e\u003cli\u003e\u003ccode\u003e/etc/docker/daemon.json\u003c/code\u003e - configuration du daemon Docker\u003c/li\u003e\u003c/ul\u003e\u003c/div\u003e\n\u003cp\u003eSelon moi, câ€™est avantageux de configurer diffÃ©remment ces mappings sur les machines des dÃ©veloppeurs et en CI/production. En effet : autant tirer profit de cette flexibilitÃ© pour dÃ©velopper confortablement tout en gardant la production sous contrÃ´le.\u003c/p\u003e\n\u003csection class=\"doc-section level-2\"\u003e\u003ch3 id=\"_mappings_de_dev\"\u003eMappings de dev\u003c/h3\u003e\u003cp\u003eEn mappant le \u003ccode\u003eroot\u003c/code\u003e des conteneurs vers ton utilisateur hÃ´te, tu peux simplement profiter dâ€™une transparence de permissions par dÃ©faut. Plus de problÃ¨mes avec les volumes gÃ©nÃ©rÃ©s en \u003ccode\u003eroot\u003c/code\u003e hÃ´te puis crashant lâ€™exÃ©cution Ã  cause de la mauvaise permission !\u003c/p\u003e\n\u003cp\u003ePour ma part, je map simplement \u003ccode\u003eroot\u003c/code\u003e vers mon user hÃ´te puis tous les autres uids 1+ vers 100001+ sur lâ€™hÃ´te.\u003c/p\u003e\n\u003cp\u003eLa seule chose Ã  confirmer : lâ€™id de ton utilisateur hÃ´te. Câ€™est souvent 1000 et câ€™est vÃ©rifiable en exÃ©cutant \u003ccode\u003eid -u\u003c/code\u003e.\u003c/p\u003e\n\u003ch5 id=\"_etcsubuid\" class=\"discrete\"\u003e/etc/subuid\u003c/h5\u003e\n\u003cdiv class=\"listing-block\"\u003e\u003cpre class=\"highlightjs highlight\"\u003e\u003ccode class=\"language-none hljs\"\u003edockremap:1000:1\ndockremap:100001:65536\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003ch5 id=\"_explication\" class=\"discrete\"\u003eExplication\u003c/h5\u003e\n\u003cp\u003eUn mapping nommÃ© \u003ccode\u003edockremap\u003c/code\u003e est crÃ©Ã© :\u003c/p\u003e\n\u003cdiv class=\"ulist\"\u003e\u003cul\u003e\u003cli\u003e\u003cem\u003e1e ligne :\u003c/em\u003e assigne 1 utilisateur (de conteneur pour nous) vers lâ€™uid 1000. Ce 1e utilisateur est lâ€™utilisateur 0, donc \u003ccode\u003eroot\u003c/code\u003e.\u003c/li\u003e\u003cli\u003e\u003cem\u003e2e ligne :\u003c/em\u003e assigne les 65536 prochains utilisateurs vers la plage commenÃ§ant par 100001, donc vers 100001-165536. Par exemple, lâ€™utilisateur conteneur 66 sera manipulÃ© sur lâ€™hÃ´te comme Ã©tant lâ€™utilisateur 100066.\u003c/li\u003e\u003c/ul\u003e\u003c/div\u003e\n\u003cp\u003eJe pense quâ€™appliquer le mÃªme principe pour les groupes est tout aussi profitable : la transparence est totale. On peut vÃ©rifier son \u003ccode\u003egid\u003c/code\u003e avec \u003ccode\u003eid -g\u003c/code\u003e.\u003c/p\u003e\n\u003ch5 id=\"_etcsubgid\" class=\"discrete\"\u003e/etc/subgid\u003c/h5\u003e\n\u003cdiv class=\"listing-block\"\u003e\u003cpre class=\"highlightjs highlight\"\u003e\u003ccode class=\"language-none hljs\"\u003edockremap:1000:1\ndockremap:100001:65536\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003ch5 id=\"_etcdockerdaemon_json\" class=\"discrete\"\u003e/etc/docker/daemon.json\u003c/h5\u003e\n\u003cdiv class=\"listing-block\"\u003e\u003cpre class=\"highlightjs highlight\"\u003e\u003ccode class=\"language-json hljs\" data-lang=\"json\"\u003e\u003cspan class=\"hljs-punctuation\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"hljs-attr\"\u003e\"userns-remap\"\u003c/span\u003e\u003cspan class=\"hljs-punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\"dockremap\"\u003c/span\u003e\n\u003cspan class=\"hljs-punctuation\"\u003e}\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eNâ€™oublie pas de redÃ©marrer le daemon docker pour que cela prenne effet ğŸ˜‰\u003c/p\u003e\n\u003cdiv class=\"listing-block\"\u003e\u003cpre class=\"highlightjs highlight\"\u003e\u003ccode class=\"language-bash hljs\" data-lang=\"bash\"\u003esudo service docker restart\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/section\u003e\n\u003csection class=\"doc-section level-2\"\u003e\u003ch3 id=\"_mappings_de_ciproduction\"\u003eMappings de CI/production\u003c/h3\u003e\u003cp\u003eEn production, la configuration dÃ©pend davantage des permissions que tu veux donner Ã  tes conteneurs. On est davantage sur des problÃ©matiques de sÃ©curitÃ© que de praticitÃ©.\u003c/p\u003e\n\u003cp\u003eIl est possible dâ€™appliquer le mÃªme type de configuration que prÃ©cÃ©demment Ã  condition de bien connaÃ®tre les consÃ©quences du mapping, en particulier pour lâ€™utilisateur 0.\u003c/p\u003e\u003c/section\u003e\u003c/section\u003e\n\u003csection class=\"doc-section level-1\"\u003e\u003ch2 id=\"_problÃ¨mes_et_trucs_Ã _savoir\"\u003eProblÃ¨mes et trucs Ã  savoir\u003c/h2\u003e\u003cp\u003eIl est possible de mapper plusieurs utilisateurs spÃ©cifiques conteneur vers des utilisateurs spÃ©cifiques hÃ´te. Par exemple :\u003c/p\u003e\n\u003cdiv class=\"listing-block\"\u003e\u003cpre class=\"highlightjs highlight\"\u003e\u003ccode class=\"language-none hljs\"\u003edockremap:1000:1\ndockremap:100001:65\ndockremap:666:1\ndockremap:100067:65469\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eCe qui peut se lire : map 0 conteneur vers 1000 hÃ´te, map les 65 utilisateurs suivants sur la plage hÃ´te commenÃ§ant par 100001, map le suivant (66) vers 666 sur lâ€™hÃ´te, map le reste sur la plage hÃ´te commenÃ§ant par 100067.\u003c/p\u003e\n\u003chr\u003e\n\u003cp\u003eJâ€™espÃ¨re que cet article tâ€™aura Ã©clairÃ© sur lâ€™utilisation des \u003cem\u003euser namespaces\u003c/em\u003e pour gÃ©rer ses permissions Docker. Il sâ€™agit dâ€™un retour dâ€™expÃ©rience personnelle et de mes avis sur le sujet. Nâ€™hÃ©site pas Ã  explorer par toi-mÃªme, faire ta propre configuration et \u003ca href=\"/fr/about/\"\u003eme la partager\u003c/a\u003e ğŸ™‚\u003c/p\u003e\u003c/section\u003e","categories":["devops"]}]},"__N_SSG":true},"page":"/fr","query":{},"buildId":"XfiD0591POrqhAMreRIZE","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>